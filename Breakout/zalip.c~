#include <ncurses.h>
#define DELAY 3000000
int main() {
  initscr();
  start_color();
  init_pair(1, COLOR_WHITE, COLOR_WHITE);
  init_pair(2, COLOR_WHITE, COLOR_BLACK);
  init_pair(3, COLOR_RED, COLOR_RED);
  init_pair(4, COLOR_YELLOW, COLOR_YELLOW);
  init_pair(5, COLOR_BLUE, COLOR_BLUE);
  init_pair(6, COLOR_GREEN, COLOR_GREEN);
  int x_plat = 10, y_plat = 30;
  int size_plat = 10;
  int x_kir = 0, y_kir = 100000;
  int max_x = 0, max_y = 0;
  int size_kir;
  cbreak();
  timeout(5);
  wbkgd(stdscr, COLOR_PAIR(2));
  noecho();
  curs_set(FALSE);
  getmaxyx(stdscr, max_y, max_x);
  // for (int i = 0; i < size_plat; ++i) {
  //     mvprintw(y_plat, x_plat + i, "-");
  //     attron(COLOR_PAIR(1));
  // }
  while (true) {
    switch (getch()) {
    case 68: //left
      if (x_plat - 1 >= 0) {
	mvprintw(y_plat, x_plat + size_plat - 1, " ");
	x_plat--;
	attron(COLOR_PAIR(1));
	mvprintw(y_plat, x_plat, " ");
	attroff(COLOR_PAIR(1));
      }
      break;
    case 67: //right
      if (max_x >= x_plat + size_plat + 1) {
	mvprintw(y_plat, x_plat, " ");
	x_plat++;
	attron(COLOR_PAIR(1));
	mvprintw(y_plat, x_plat + size_plat - 1, " ");
	attroff(COLOR_PAIR(1));
      }
      break;
    }
    max_x = max_x - max_x % 3;
    y_kir++;
    int color = 0;
    for(int l = 2; l < 20000; l += 2) { 
      for (x_kir = 0; x_kir <= max_x; x_kir++) {
	if (x_kir % 3) {
	  attron(COLOR_PAIR(color));
	  mvprintw(l, x_kir, " ");
	  attroff(COLOR_PAIR(color));
	  size_kir = x_kir % 7;
	}   
	else {
	  color = rand() % 4 + 3;
	}
      }
    }
        
    refresh();
  }
  endwin();
}
